#namenode service
kind: Service
apiVersion: v1
metadata:
  name: hadoop-namenode-service
  namespace: hadoop
  labels:
    app: hadoop
    hadoop: namenode
spec:
  selector:
    hadoop: namenode
  ports: #Hadoop port http://fibrevillage.com/storage/637-hadoop-default-ports-reference
    - name: nn-rpc
      protocol: TCP
      port: 8020
    - name: nn-rpc-legacy
      protocol: TCP
      port: 9000
      #targetPort: 8020
    - name: nn-web #expose web interface on port 80 (9870->80)
      protocol: TCP
      port: 80
      targetPort: 50070
    - name: rm
      protocol: TCP
      port: 8032
    - name: rm-admin
      protocol: TCP
      port: 8033
    - name: rm-admin-http
      protocol: TCP
      port: 8088
    - name: rm-sched
      protocol: TCP
      port: 8030
    - name: rt
      protocol: TCP
      port: 8031
---
# stateful set
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: hadoop-namenode
  namespace: hadoop
  labels:
    app: hadoop
    hadoop: namenode
spec:
  serviceName: hadoop-namenode-service
  replicas: 1 
  selector:
    matchLabels:
      hadoop: namenode
  template: #pod template .spec.template
    metadata:
      namespace: hadoop
      labels:
        app: hadoop
        hadoop: namenode
    spec:
      hostname: hadoop-namenode-service
      containers:
        - name: hadoop-namenode
          #image: babbleshack/hadoop:namenode
          image: babbleshack/hadoop:hadoop-rm
          imagePullPolicy: Always
          volumeMounts:
            - name: namenode-pv-claim 
              mountPath: /hadoop/data
          ports:
            - name: nn-web
              containerPort: 50070
            - name: nn-rpc
              containerPort: 8020
            - name: rm
              containerPort: 8032
            - name: rm-admin
              containerPort: 8033
            - name: rm-admin-http
              containerPort: 8088
            - name: rm-sched
              containerPort: 8030
            - name: rt
              containerPort: 8031
            - name: nn-rpc-legacy
              containerPort: 9000
          env:
            - name: CLUSTER_NAME
              value: hdfs-k8s
  volumeClaimTemplates: #volume claim .spec.volumeClaimTemplate
    - metadata:
        name: namenode-pv-claim
      spec:
        accessModes:
        - ReadWriteOnce
        storageClassName: local-storage
        resources:
          requests:
            storage: 5Gi
